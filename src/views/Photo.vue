<template>
  <div>
    <div class="header header-not-home">
      <div class="container container-header">
        <div class="logo">
          <router-link class="about-link" tag="a" to="/" title="–ù–∞ –≥–ª–∞–≤–Ω—É—é">
            <img :src="this.publicPath + 'footer.png'" alt="" width="200px" height="auto" alt="DriV3R">
          </router-link>
        </div>
        <div class="header-items">
          <p class="header-item">
            –ú—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è: –≥. –ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫, —É–ª. –õ–µ–Ω–∏–Ω–∞, 83 | –¢–¶ "–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç", 3 —ç—Ç–∞–∂
          </p>
          <p class="header-item">
            –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 10:00 –¥–æ 21:00
          </p>
        </div>
        <div class="header-info">
          <div class="tel">
            <a href="tel: +79000939392" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º">+7 (900) 093-93-92</a>
          </div>
          <div class="social">
            <a href="https://vk.com/mgnvr" target="_blank" title="–ú—ã –í–ö–æ–Ω—Ç–∞–∫—Ç–µ">
              <img :src="this.publicPath + 'vk.svg'" alt="" width="30px" height="30px">
            </a>
          </div>
          <router-link class="link" tag="a" to="/about" title="–û –Ω–∞—Å">–û –Ω–∞—Å</router-link>
        </div>
      </div>
    </div>
    <div class="container container-about">
      <div class="breadcrumb-container">
        <!--         <vk-breadcrumb>
          <router-link class="home" tag="vk-breadcrumb-item" to="/" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É">–ì–ª–∞–≤–Ω–∞—è</router-link>
          <vk-breadcrumb-item>–û –Ω–∞—Å</vk-breadcrumb-item>
        </vk-breadcrumb> -->
        <router-link class="link-home" tag="a" to="/" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é">
          ‚ùÆ –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </router-link>
      </div>
      <h1>–£—Å–ª—É–≥–∞ "–•—Ä–æ–º–∞–∫–µ–π"</h1>
      <h2 style="margin-top: 20px; font-size: 25px;">–ó–∞–±–µ—Ä–∏ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è —Å —Å–æ–±–æ–π üì∏</h2>
      <div class="photo-algorithm">
        <div class="algorithm-item">
          <img :src="this.publicPath + 'choice.svg'" alt="" width="50px" height="50px">
          <p>1. –í—ã–±–µ—Ä–∏ —Ñ–æ–Ω</p>
        </div>
        <div class="algorithm-item">
          <img :src="this.publicPath + 'pose.svg'" alt="" width="50px" height="50px">
          <p>2. –ó–∞–º—Ä–∏</p>
        </div>
        <div class="algorithm-item">
          <img :src="this.publicPath + 'photo.svg'" alt="" width="50px" height="50px">
          <p>3. –ó–∞–±–µ—Ä–∏</p>
        </div>
      </div>

      <div class="chromakey">
        <div class="chromakey__polaroid">
          <div ref="polaroid" class="chromakey__polaroid-back">
            <div class="chromakey__polaroid-img">
              <img ref="photoMockup" class="polaroid-photo" :src="this.publicPath + 'backgrounds/city/new_york.jpg'">
              <div class="chromakey__polaroid-human"></div>
              <div class="chromakey__polaroid-img-wrapper"></div>
            </div>
          </div>
        </div>
        <div class="chromakey__backgrounds">
          <div class="chromakey__backgrounds-control">
            <label class="label-genre" for="theme">–í—ã–±—Ä–∞—Ç—å —Ç–µ–º—É</label>
            <select v-model="theme" class="uk-select" id="theme">
              <option :selected="theme === '–≤—Å–µ'" value="–≤—Å–µ">–≤—Å–µ</option>
              <option>–≥–æ—Ä–æ–¥</option>
              <option>–ø—Ä–∏—Ä–æ–¥–∞</option>
            </select>
          </div>
          <vue-select-image :dataImages="changeTheme" :selectedImages="selectedBacks" :useLabel=true @onselectimage="onSelectImage">
          </vue-select-image>
        </div>
      </div>

    </div>
    <div class="footer">
      <div class="container container-footer">
        <div class="logo">
          <router-link class="about-link" tag="a" to="/about" title="–û –Ω–∞—Å">
            <img :src="this.publicPath + 'footer.png'" alt="" width="200px" height="auto" alt="DriV3R">
          </router-link>
        </div>
        <div class="tel">
          <a href="tel: +79000939392" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞–º">+7 (900) 093-93-92</a>
        </div>
        <div class="social">
          <a href="https://vk.com/mgnvr" target="_blank" title="–ú—ã –í–ö–æ–Ω—Ç–∞–∫—Ç–µ">
            <img :src="this.publicPath + 'vk.svg'" alt="" width="30px" height="30px">
          </a>
        </div>
        <div class="copyright">
          &#9400; Driv3r, 2017 - 2020 | –ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
        </div>
        <div class="developer">
          –î–∏–∑–∞–π–Ω –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ <a href="https://vk.com/primirenkov" target="_blank"><img :src="this.publicPath + 'ps.svg'" alt="–°–µ—Ä–≥–µ–π –ü—Ä–∏–º–∏—Ä–µ–Ω–∫–æ–≤"></a>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
import VueSelectImage from 'vue-select-image'

export default {
  name: 'photo',
  data() {
    return {
      backgrounds: [],
      theme: '–≤—Å–µ',
      sitename: 'Driv3r - –ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä',
      publicPath: process.env.BASE_URL,
      index: null,
      windowWidth: 0,
      selectedBacks: [{
        id: 1
      }]
    }
  },
  components: {
    'vue-select-image': VueSelectImage
  },
  methods: {
    onSelectImage: function(image) {
      this.$refs.photoMockup.src = image.src

      var
            fac = new FastAverageColor(),
            container = document.querySelector('.chromakey__polaroid-img-wrapper'),
            img = document.querySelector('.polaroid-photo')

        fac.getColorAsync(img)
            .then(function(color) {
                container.style.backgroundColor = color.rgba
            })
            .catch(function(e) {
                console.log(e)
            });
    },
    getWindowWidth(event) {
      this.windowWidth = window.innerWidth

      var heightPolaroid = document.querySelector('.chromakey__polaroid').offsetHeight;
      var heightBackControl = document.querySelector('.chromakey__backgrounds-control').offsetHeight
      var actualWindowWidth = window.innerWidth

      var imageWrapper = document.querySelector('.vue-select-image__wrapper')

      if (this.windowWidth >= 768) {
        imageWrapper.style.height = (heightPolaroid - heightBackControl) + 'px'
      }
    }
  },
  mounted() {
    this.$store.dispatch('loadBackgrounds')

    this.$nextTick(function() {
      window.addEventListener('resize', this.getWindowWidth);

      //Init
      this.getWindowWidth()
    })
  },
  beforeUpdate() {
    var heightPolaroid = document.querySelector('.chromakey__polaroid').offsetHeight
    var heightBackControl = document.querySelector('.chromakey__backgrounds-control').offsetHeight
    var actualWindowWidth = window.innerWidth

    var imageWrapper = document.querySelector('.vue-select-image__wrapper')

    this.windowWidth = window.innerWidth

    $('.vue-select-image__wrapper').on('mousewheel DOMMouseScroll', function(e) {

      var e0 = e.originalEvent;
      var delta = e0.wheelDelta || -e0.detail;

      this.scrollTop += (delta < 0 ? 1 : -1) * 30;
      e.preventDefault();
    })

    if (this.windowWidth >= 768) {
      imageWrapper.style.height = (heightPolaroid - heightBackControl) + 'px'
    }

    imageWrapper.classList.add('scrollbar-rail');

    $('.scrollbar-rail').scrollbar();

    var
            fac = new FastAverageColor(),
            container = document.querySelector('.chromakey__polaroid-img-wrapper'),
            img = document.querySelector('.polaroid-photo');

        fac.getColorAsync(img)
            .then(function(color) {
                container.style.backgroundColor = color.rgba;
            })
            .catch(function(e) {
                console.log(e);
            });
  },
  updated() {
    var heightPolaroid = document.querySelector('.chromakey__polaroid').offsetHeight
    var heightBackControl = document.querySelector('.chromakey__backgrounds-control').offsetHeight
    var actualWindowWidth = window.innerWidth

    var imageWrapper = document.querySelector('.vue-select-image__wrapper')

    if (this.windowWidth >= 768) {
      imageWrapper.style.height = (heightPolaroid - heightBackControl) + 'px'
    }


  },
  computed: {
    changeTheme() {
      return this.$store.getters.showBackgrounds(this.theme)
    }
  },
  beforeDestroy() {
    window.removeEventListener('resize', this.getWindowWidth)
  }
}

</script>
